export type TestCaseArea =
  | 'authentication'
  | 'discovery'
  | 'search'
  | 'booking'
  | 'payment';

export type TestCaseType = 'positive' | 'negative';

export type TestCase = {
  id: string;
  area: TestCaseArea;
  type: TestCaseType;
  title: string;
  description: string;
  preconditions: string[];
  steps: string[];
  expected: string[];
  notes?: string;
};

export const comprehensiveTestCasesFixture: TestCase[] = [
  {
    id: 'auth/signup-success',
    area: 'authentication',
    type: 'positive',
    title: 'User signs up with valid credentials',
    description: 'New user registers with unique email/password and receives verification prompt.',
    preconditions: ['Email not already in use', 'Valid password meeting policy'],
    steps: ['Submit signup form with valid data'],
    expected: [
      '201 response with user id',
      'Verification email enqueued',
      'Redirect to dashboard or verification screen'
    ],
    notes: 'Validate payload with Zod prior to request.',
  },
  {
    id: 'auth/signup-duplicate',
    area: 'authentication',
    type: 'negative',
    title: 'Signup blocked for existing email',
    description: 'Attempting to register with an email that already exists is rejected.',
    preconditions: ['User already exists with the same email'],
    steps: ['Submit signup form with duplicate email'],
    expected: ['409 response', 'Friendly error toast', 'No duplicate row created'],
  },
  {
    id: 'auth/login-success',
    area: 'authentication',
    type: 'positive',
    title: 'User logs in with correct credentials',
    description: 'Existing user logs in and receives a session cookie.',
    preconditions: ['User exists with verified email', 'Correct password'],
    steps: ['Submit login form with valid credentials'],
    expected: ['200 response', 'Session cookie set', 'Redirect to dashboard'],
  },
  {
    id: 'auth/login-wrong-password',
    area: 'authentication',
    type: 'negative',
    title: 'Login fails with wrong password',
    description: 'Incorrect password results in an error without establishing a session.',
    preconditions: ['User exists', 'Incorrect password provided'],
    steps: ['Submit login form with invalid password'],
    expected: ['401 response', 'Error toast displayed', 'No session cookie set'],
  },
  {
    id: 'auth/token-expired',
    area: 'authentication',
    type: 'negative',
    title: 'Access to protected route with expired token',
    description: 'Expired JWT is rejected and user is redirected to login.',
    preconditions: ['Expired session token present'],
    steps: ['Request protected page with expired token'],
    expected: ['401 response', 'Session cleared', 'Redirect to login with message'],
  },
  {
    id: 'discovery/list-default',
    area: 'discovery',
    type: 'positive',
    title: 'List spaces without filters',
    description: 'Spaces load with server-side rendering and pagination defaults.',
    preconditions: ['Spaces exist in database'],
    steps: ['Navigate to discovery page without filters'],
    expected: ['200 response', 'Spaces rendered with pagination', 'Initial cache hydrated'],
  },
  {
    id: 'discovery/filter-amenities',
    area: 'discovery',
    type: 'positive',
    title: 'Filter by amenities',
    description: 'Applying amenity filters returns only spaces that include them.',
    preconditions: ['Spaces have varied amenity sets'],
    steps: ['Select one or more amenities and submit filters'],
    expected: ['Results all contain selected amenities', 'Filter tags visible', 'Pagination consistent'],
  },
  {
    id: 'discovery/filter-location',
    area: 'discovery',
    type: 'positive',
    title: 'Filter by location radius',
    description: 'Location filter uses PostGIS to return spaces within the selected radius.',
    preconditions: ['Spaces have geocoded coordinates'],
    steps: ['Apply map/radius filter', 'Submit search'],
    expected: ['Only spaces within radius returned', 'Map bounds align with results'],
  },
  {
    id: 'discovery/no-results',
    area: 'discovery',
    type: 'negative',
    title: 'No results state',
    description: 'Unsupported filter combinations show an empty state with clear filters CTA.',
    preconditions: ['Filters that produce no results'],
    steps: ['Apply restrictive filters', 'View results'],
    expected: ['Empty state displayed', 'Clear filters button visible', 'No errors thrown'],
  },
  {
    id: 'search/keyword',
    area: 'search',
    type: 'positive',
    title: 'Keyword search matches title and description',
    description: 'Keyword search hits are ranked using pg_trgm/unaccent on title and description.',
    preconditions: ['Spaces with matching keywords in title and description'],
    steps: ['Enter keyword query', 'Submit search'],
    expected: ['Results ranked by relevance', 'Highlighting matches query', 'Stable ordering across pages'],
  },
  {
    id: 'search/sort-price',
    area: 'search',
    type: 'positive',
    title: 'Sort search results by price',
    description: 'Sorting by price asc/desc returns consistently ordered and paginated results.',
    preconditions: ['Spaces with varying prices'],
    steps: ['Search with keyword', 'Select price ascending', 'Select price descending'],
    expected: ['Sorted ascending correctly', 'Sorted descending correctly', 'Pagination stable between sorts'],
  },
  {
    id: 'search/invalid-query',
    area: 'search',
    type: 'negative',
    title: 'Invalid search query rejected',
    description: 'Too-short or unsafe queries are blocked client-side via Zod validation.',
    preconditions: ['Query shorter than minimum length or with disallowed characters'],
    steps: ['Enter invalid query', 'Attempt to submit search'],
    expected: ['Validation error shown', 'No API call triggered', 'Input retains focus for correction'],
  },
  {
    id: 'booking/create-success',
    area: 'booking',
    type: 'positive',
    title: 'Booking created successfully',
    description: 'User books an available timeslot and receives confirmation.',
    preconditions: ['User logged in', 'Space has available slot'],
    steps: ['Select date/time', 'Submit booking form'],
    expected: [
      'Availability check passes',
      'Booking row created with pending payment or confirmed status',
      'Confirmation email enqueued'
    ],
  },
  {
    id: 'booking/conflict',
    area: 'booking',
    type: 'negative',
    title: 'Booking conflict detected',
    description: 'Overlapping booking attempts are rejected with clear messaging.',
    preconditions: ['Existing booking occupies selected slot'],
    steps: ['Select overlapping date/time', 'Submit booking'],
    expected: ['409 response', 'Error toast shown', 'Availability refreshed'],
  },
  {
    id: 'booking/cancel-policy',
    area: 'booking',
    type: 'positive',
    title: 'Cancellation within policy window',
    description: 'Booking cancelled within policy triggers refund and status update.',
    preconditions: ['Active booking within allowed cancellation window'],
    steps: ['Request cancellation'],
    expected: ['Booking status updated to cancelled', 'Refund initiated', 'History entry recorded'],
  },
  {
    id: 'booking/cancel-late',
    area: 'booking',
    type: 'negative',
    title: 'Late cancellation blocked',
    description: 'Cancellation outside policy window is prevented with policy messaging.',
    preconditions: ['Active booking outside cancellation window'],
    steps: ['Attempt cancellation'],
    expected: ['Cancellation rejected', 'Policy message shown', 'Booking status unchanged'],
  },
  {
    id: 'booking/guest-capacity',
    area: 'booking',
    type: 'negative',
    title: 'Guest capacity exceeded',
    description: 'Guest count exceeding capacity is blocked before persistence.',
    preconditions: ['Booking form allows guest count input'],
    steps: ['Enter guest count above capacity', 'Submit booking form'],
    expected: ['Validation error shown', 'No booking created', 'Capacity badge displayed'],
  },
  {
    id: 'payment/complete-success',
    area: 'payment',
    type: 'positive',
    title: 'Payment completes successfully',
    description: 'Successful payment intent marks booking as paid and stores receipt.',
    preconditions: ['Pending booking requiring payment', 'Valid payment method'],
    steps: ['Initiate payment', 'Complete payment flow'],
    expected: ['Payment intent succeeds', 'Booking marked paid', 'Receipt stored and badge shown'],
  },
  {
    id: 'payment/decline',
    area: 'payment',
    type: 'negative',
    title: 'Card declined handling',
    description: 'Declined payments leave booking unpaid and surface retry options.',
    preconditions: ['Pending booking', 'Payment method causes decline'],
    steps: ['Attempt payment with failing card'],
    expected: ['Payment intent fails', 'Error toast displayed', 'Booking remains pending with retry CTA'],
  },
  {
    id: 'payment/webhook-replay',
    area: 'payment',
    type: 'negative',
    title: 'Webhook replay is idempotent',
    description: 'Duplicate webhooks do not double-charge or change status twice.',
    preconditions: ['Existing successful payment event'],
    steps: ['Send duplicate webhook payload with same idempotency key'],
    expected: ['Second delivery is ignored', 'No duplicate ledger entries', 'Booking status unchanged'],
  },
  {
    id: 'payment/partial-capture',
    area: 'payment',
    type: 'positive',
    title: 'Partial capture flow',
    description: 'Partial payment capture stores captured amount and remaining balance.',
    preconditions: ['Payment intent supports capture', 'Booking eligible for partial capture'],
    steps: ['Authorize full amount', 'Capture partial amount'],
    expected: ['Captured amount stored', 'Remaining balance tracked', 'Booking status reflects partial capture'],
  },
  {
    id: 'payment/refund',
    area: 'payment',
    type: 'positive',
    title: 'Refund processing',
    description: 'Refund endpoint reverses payment and updates booking state.',
    preconditions: ['Completed payment', 'Refund eligibility met'],
    steps: ['Request refund via API or UI'],
    expected: ['Refund processed', 'Booking status adjusted', 'Ledger entry written'],
  },
  {
    id: 'payment/fraud-check',
    area: 'payment',
    type: 'negative',
    title: 'Fraud flag halts fulfillment',
    description: 'Fraud-detected payments are put into review and not fulfilled.',
    preconditions: ['Fraud rules active'],
    steps: ['Process payment flagged by fraud checks'],
    expected: ['Booking set to review', 'User notified', 'No fulfillment actions taken'],
  }
];
