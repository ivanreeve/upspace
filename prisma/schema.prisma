generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [pg_trgm, postgis, uuid_ossp(map: "uuid-ossp", schema: "extensions")]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model amenity {
  amenity_choice_id String         @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at        DateTime       @default(now()) @db.Timestamptz(6)
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  space_id          String         @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  amenity_choice    amenity_choice @relation(fields: [amenity_choice_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  space             space          @relation(fields: [space_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model amenity_choice {
  id         String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String           @unique
  category   amenity_category
  created_at DateTime         @default(now()) @db.Timestamptz(6)
  identifier String?
  amenity    amenity[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model app_notification {
  id           String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_auth_id String            @db.Uuid
  title        String
  body         String
  href         String
  type         notification_type @default(system)
  created_at   DateTime          @default(now()) @db.Timestamptz(6)
  read_at      DateTime?         @db.Timestamptz(6)
  booking_id   String?           @db.Uuid
  space_id     String?           @db.Uuid
  area_id      String?           @db.Uuid
  area         area?             @relation(fields: [area_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "app_notification_area_fk")
  booking      booking?          @relation(fields: [booking_id], references: [id], onUpdate: NoAction, map: "app_notification_booking_fk")
  space        space?            @relation(fields: [space_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "app_notification_space_fk")

  @@index([booking_id], map: "idx_app_notification_booking")
  @@index([user_auth_id, created_at(sort: Desc)], map: "idx_app_notification_user_created")
  @@index([user_auth_id, read_at], map: "idx_app_notification_user_read")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model area {
  name                         String
  created_at                   DateTime           @default(now()) @db.Timestamptz(6)
  updated_at                   DateTime?          @default(now()) @db.Timestamptz(6)
  max_capacity                 BigInt?
  id                           String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  space_id                     String             @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  price_rule_id                String?            @db.Uuid
  automatic_booking_enabled    Boolean            @default(false)
  request_approval_at_capacity Boolean            @default(false)
  advance_booking_enabled      Boolean            @default(false)
  advance_booking_value        Int?
  advance_booking_unit         String?
  booking_notes_enabled        Boolean            @default(false)
  booking_notes                String?
  app_notification             app_notification[]
  price_rule                   price_rule?        @relation(fields: [price_rule_id], references: [id], onDelete: Restrict, onUpdate: NoAction)
  space                        space              @relation(fields: [space_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  booking                      booking[]

  @@index([price_rule_id], map: "idx_area_price_rule_id")
  @@index([space_id, price_rule_id], map: "idx_area_space_price_rule")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model audit_event {
  audit_id      BigInt      @id @default(autoincrement())
  occured_at    DateTime    @default(now()) @db.Timestamptz(6)
  created_at    DateTime    @default(now()) @db.Timestamptz(6)
  actor_user_id BigInt?
  actor_label   String?
  session_id    String?
  request_id    String?
  action        auditAction
  object_table  String
  object_pk     String
  outcome       String      @default("\"success\"")
  reason        String?
  old_value     Json?
  new_value     Json?
  extra         Json?
  user          user?       @relation(fields: [actor_user_id], references: [user_id], onDelete: Restrict)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model booking {
  id                String             @id(map: "booking_pkey1") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  space_id          String             @db.Uuid
  space_name        String
  area_id           String             @db.Uuid
  area_name         String
  booking_hours     BigInt
  price_minor       BigInt?
  currency          String             @default("PHP") @db.Char(3)
  status            booking_status     @default(confirmed)
  created_at        DateTime           @default(now()) @db.Timestamptz(6)
  user_auth_id      String             @db.Uuid
  partner_auth_id   String?            @db.Uuid
  area_max_capacity BigInt?
  expires_at        DateTime           @db.Timestamptz(6)
  start_at          DateTime           @default(now()) @db.Timestamptz(6)
  guest_count       Int                @default(1)
  app_notification  app_notification[]
  area              area               @relation(fields: [area_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "booking_area_fk")
  space             space              @relation(fields: [space_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "booking_space_fk")
  transaction       transaction[]

  @@index([area_id, start_at, expires_at], map: "idx_booking_area_window")
  @@index([partner_auth_id, created_at(sort: Desc)], map: "idx_booking_partner_created")
  @@index([partner_auth_id, status], map: "idx_booking_partner_status")
  @@index([space_id, created_at(sort: Desc)], map: "idx_booking_space_created")
  @@index([user_auth_id], map: "idx_booking_user_auth_id")
  @@index([user_auth_id, created_at(sort: Desc)], map: "idx_booking_user_created")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model bookmark {
  bookmark_id BigInt   @id @unique @default(autoincrement())
  user_id     BigInt
  created_at  DateTime @db.Timestamptz(6)
  space_id    String?  @db.Uuid
  space       space?   @relation(fields: [space_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user        user     @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model chat_message {
  id          String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  room_id     String           @db.Uuid
  sender_id   BigInt
  sender_role chat_sender_role
  content     String
  created_at  DateTime         @default(now()) @db.Timestamptz(6)
  chat_room   chat_room        @relation(fields: [room_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user        user             @relation(fields: [sender_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([room_id, created_at])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model chat_room {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  space_id     String         @db.Uuid
  customer_id  BigInt
  created_at   DateTime       @default(now()) @db.Timestamptz(6)
  chat_message chat_message[]
  user         user           @relation(fields: [customer_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  space        space          @relation(fields: [space_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([space_id, customer_id])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model common_review {
  id         String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at DateTime       @default(now()) @db.Timestamptz(6)
  review_id  String         @db.Uuid
  comment    common_comment
  review     review         @relation(fields: [review_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model deactivation_request {
  id                                                   String                       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                                              BigInt
  auth_user_id                                         String                       @db.Uuid
  email                                                String
  reason_category                                      deactivation_reason_category
  custom_reason                                        String?
  status                                               deactivation_request_status  @default(pending)
  rejection_reason                                     String?
  created_at                                           DateTime                     @default(now()) @db.Timestamptz(6)
  updated_at                                           DateTime                     @default(now()) @db.Timestamptz(6)
  processed_at                                         DateTime?                    @db.Timestamptz(6)
  processed_by_user_id                                 BigInt?
  type                                                 deactivation_request_type    @default(deactivate)
  user_deactivation_request_processed_by_user_idTouser user?                        @relation("deactivation_request_processed_by_user_idTouser", fields: [processed_by_user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  user_deactivation_request_user_idTouser              user                         @relation("deactivation_request_user_idTouser", fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([auth_user_id], map: "idx_deactivation_request_auth_user")
  @@index([status, created_at], map: "idx_deactivation_request_status_created")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model price_rule {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at  DateTime  @default(now()) @db.Timestamptz(6)
  space_id    String    @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String
  description String
  definition  Json
  updated_at  DateTime? @db.Timestamptz(6)
  area        area[]
  space       space     @relation(fields: [space_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model review {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  space_id      String          @db.Uuid
  user_id       BigInt?
  rating_star   BigInt
  description   String
  created_at    DateTime        @default(now()) @db.Timestamptz(6)
  common_review common_review[]
  space         space           @relation(fields: [space_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user          user?           @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model signup_otps {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email      String   @unique
  hash       String
  expires_at DateTime @db.Timestamptz(6)
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model space {
  name                 String
  unit_number          String
  street               String
  address_subunit      String
  city                 String
  region               String
  created_at           DateTime                  @db.Timestamptz(6)
  updated_at           DateTime                  @db.Timestamptz(6)
  postal_code          String
  user_id              BigInt
  description          String?
  country_code         String                    @db.Char(2)
  lat                  Decimal                   @db.Decimal(9, 6)
  long                 Decimal                   @db.Decimal(9, 6)
  barangay             String?
  id                   String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  location             Unsupported("geography")?
  is_published         Boolean                   @default(false)
  unpublished_at       DateTime?                 @db.Timestamptz(6)
  unpublished_reason   String?
  unpublished_by_admin Boolean                   @default(false)
  amenity              amenity[]
  app_notification     app_notification[]
  area                 area[]
  booking              booking[]
  bookmark             bookmark[]
  chat_room            chat_room[]
  price_rule           price_rule[]
  review               review[]
  user                 user                      @relation(fields: [user_id], references: [user_id])
  space_availability   space_availability[]
  space_image          space_image[]
  unpublish_request    unpublish_request[]
  verification         verification[]

  @@index([location], type: Gist)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model space_availability {
  created_at  DateTime  @default(now()) @db.Timestamptz(6)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)
  opening     DateTime  @db.Timestamptz(6)
  closing     DateTime  @db.Timestamptz(6)
  day_of_week Int       @db.SmallInt
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  space_id    String?   @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  space       space?    @relation(fields: [space_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model space_image {
  path          String
  display_order BigInt?
  is_primary    Float
  created_at    DateTime @db.Timestamptz(6)
  category      String?
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  space_id      String   @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  space         space    @relation(fields: [space_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model transaction {
  transaction_id  BigInt    @id @unique @default(autoincrement())
  booking_id      String    @db.Uuid
  is_live         Boolean   @default(false)
  created_at      DateTime  @default(now()) @db.Timestamptz(6)
  idempotency_key String    @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)
  gateway_data    Json      @unique
  payment_method  gateway
  currency_iso3   String    @default("PHP") @db.Char(3)
  amount_minor    BigInt?
  fee_minor       BigInt?
  booking         booking   @relation(fields: [booking_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model unpublish_request {
  id                                                String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  space_id                                          String                   @db.Uuid
  user_id                                           BigInt
  status                                            unpublish_request_status @default(pending)
  reason                                            String?
  rejection_reason                                  String?
  processed_by_user_id                              BigInt?
  created_at                                        DateTime                 @default(now()) @db.Timestamptz(6)
  updated_at                                        DateTime                 @default(now()) @db.Timestamptz(6)
  processed_at                                      DateTime?                @db.Timestamptz(6)
  user_unpublish_request_processed_by_user_idTouser user?                    @relation("unpublish_request_processed_by_user_idTouser", fields: [processed_by_user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  space                                             space                    @relation(fields: [space_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user_unpublish_request_user_idTouser              user                     @relation("unpublish_request_user_idTouser", fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([space_id], map: "idx_unpublish_request_space")
  @@index([status, created_at], map: "idx_unpublish_request_status_created")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model user {
  first_name                                                           String?
  birthday                                                             DateTime?              @db.Date
  created_at                                                           DateTime               @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @db.Timestamptz(6)
  updated_at                                                           DateTime               @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @db.Timestamptz(6)
  user_id                                                              BigInt                 @id @unique @default(autoincrement())
  role                                                                 user_role              @default(customer)
  middle_name                                                          String?
  last_name                                                            String?
  handle                                                               String                 @unique
  avatar                                                               String?
  is_onboard                                                           Boolean                @default(false)
  auth_user_id                                                         String                 @unique @db.Uuid
  cancelled_at                                                         DateTime?              @db.Timestamptz(6)
  deleted_at                                                           DateTime?              @db.Timestamptz(6)
  expires_at                                                           DateTime?              @db.Timestamptz(6)
  pending_deletion_at                                                  DateTime?              @db.Timestamptz(6)
  status                                                               user_status            @default(active)
  audit_event                                                          audit_event[]
  bookmark                                                             bookmark[]
  chat_message                                                         chat_message[]
  chat_room                                                            chat_room[]
  deactivation_request_deactivation_request_processed_by_user_idTouser deactivation_request[] @relation("deactivation_request_processed_by_user_idTouser")
  deactivation_request_deactivation_request_user_idTouser              deactivation_request[] @relation("deactivation_request_user_idTouser")
  review                                                               review[]
  space                                                                space[]
  unpublish_request_unpublish_request_processed_by_user_idTouser       unpublish_request[]    @relation("unpublish_request_processed_by_user_idTouser")
  unpublish_request_unpublish_request_user_idTouser                    unpublish_request[]    @relation("unpublish_request_user_idTouser")
  verification                                                         verification[]
  wallet                                                               wallet?

  @@index([expires_at], map: "idx_user_expires_at")
  @@index([status], map: "idx_user_status")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model verification {
  subject_type          verification_subject_type
  partner_id            BigInt?
  valid_until           DateTime?                 @db.Date
  submitted_at          DateTime                  @default(now()) @db.Timestamptz(6)
  approved_at           DateTime?                 @db.Timestamptz(6)
  reviewed_at           DateTime?                 @db.Timestamptz(6)
  rejected_at           DateTime?                 @db.Timestamptz(6)
  rejected_reason       String?
  created_at            DateTime                  @default(now()) @db.Timestamptz(6)
  updated_at            DateTime                  @default(now()) @db.Timestamptz(6)
  status                verification_status       @default(in_review)
  id                    String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  space_id              String                    @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user                  user?                     @relation(fields: [partner_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  space                 space                     @relation(fields: [space_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  verification_document verification_document[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model verification_document {
  created_at      DateTime                     @default(now()) @db.Timestamptz(6)
  path            String
  document_type   verification_document_type
  file_size_bytes BigInt
  mime_type       String
  status          verification_document_status @default(pending)
  expires_at      DateTime?                    @db.Date
  version         BigInt                       @default(1)
  id              String                       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  verification_id String                       @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  verification    verification                 @relation(fields: [verification_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model wallet {
  id                 String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id            BigInt               @unique
  balance_minor      BigInt               @default(0)
  currency           String               @default("PHP") @db.Char(3)
  created_at         DateTime             @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?            @default(now()) @db.Timestamptz(6)
  user               user                 @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "wallet_user_fk")
  wallet_transaction wallet_transaction[]

  @@index([user_id], map: "idx_wallet_user")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model wallet_transaction {
  id                 String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  wallet_id          String                    @db.Uuid
  type               wallet_transaction_type
  status             wallet_transaction_status @default(succeeded)
  amount_minor       BigInt
  net_amount_minor   BigInt?
  currency           String                    @default("PHP") @db.Char(3)
  description        String?
  external_reference String?
  metadata           Json?                     @db.Json
  booking_id         String?                   @db.Uuid
  created_at         DateTime                  @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?                 @default(now()) @db.Timestamptz(6)
  wallet             wallet                    @relation(fields: [wallet_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "wallet_transaction_wallet_fk")

  @@index([wallet_id, created_at(sort: Desc)], map: "idx_wallet_transaction_wallet_created")
}

enum amenity_category {
  connectivity
  seating_workspace_types
  meeting_collaboration
  equipment
  facilities_utilities
  food_beverage
  access_security
  comfort_well_being
  community_events
  parking_transport
  accessibility
  policies
  others
}

enum auditAction {
  insert
  update
  delete
  login
  logout
  permission_change
  other
}

enum auth_provider {
  google
  other
}

enum booking_status {
  pending
  confirmed
  rejected
  expired
  cancelled
  checkedin
  checkedout
  completed
  noshow
}

enum booking_type {
  instant
  request
}

enum chat_sender_role {
  customer
  partner
}

enum common_comment {
  Clean
  Well_maintained         @map("Well-maintained")
  Quiet_workspace         @map("Quiet workspace")
  Peaceful_environment    @map("Peaceful environment")
  Cozy_atmosphere         @map("Cozy atmosphere")
  Professional_vibe       @map("Professional vibe")
  Inspiring_ambiance      @map("Inspiring ambiance")
  Comfortable_seating     @map("Comfortable seating")
  Spacious_desks          @map("Spacious desks")
  Good_lighting           @map("Good lighting")
  Comfortable_temperature @map("Comfortable temperature")
  Reliable_internet       @map("Reliable internet")
  Helpful_staff           @map("Helpful staff")
  Responsive_host         @map("Responsive host")
  Convenient_location     @map("Convenient location")
  Secure_access           @map("Secure access")
  Good_value              @map("Good value")
  Sample_Comment          @map("Sample Comment")
}

enum deactivation_reason_category {
  not_using
  pricing
  privacy
  switching
  other
}

enum deactivation_request_status {
  pending
  approved
  rejected
}

enum deactivation_request_type {
  deactivate
  delete
}

enum gateway {
  paymongo
}

enum notification_type {
  booking_confirmed
  booking_received
  message
  system
}

enum unpublish_request_status {
  pending
  approved
  rejected
}

enum user_role {
  customer
  partner
  admin
}

enum user_status {
  active
  deactivated
  pending_deletion
  deleted
}

enum verification_document_status {
  pending
  approved
  rejected
  replaced
  deleted
}

enum verification_document_type {
  dti_registration
  sec_registration
  bir_cor
  authorized_rep_id
  business_permit
  business_address_proof
  occupancy_permit
}

enum verification_status {
  draft
  in_review
  approved
  rejected
  expired
}

enum verification_subject_type {
  partner
  space
}

enum wallet_transaction_status {
  pending
  succeeded
  failed
}

enum wallet_transaction_type {
  cash_in
  charge
  refund
  payout
}
