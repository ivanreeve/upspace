generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [postgis, uuid_ossp(map: "uuid-ossp", schema: "extensions")]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model amenity {
  amenity_id BigInt    @id @unique @default(autoincrement())
  name       String    @db.VarChar
  space_id   BigInt
  created_at DateTime  @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  space      space     @relation(fields: [space_id], references: [space_id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model area {
  area_id      BigInt       @id @unique @default(autoincrement())
  space_id     BigInt
  name         String       @db.VarChar
  max_capacity BigInt
  min_capacity BigInt
  created_at   DateTime     @default(now()) @db.Timestamptz(6)
  updated_at   DateTime?    @default(now()) @db.Timestamptz(6)
  space        space        @relation(fields: [space_id], references: [space_id], onDelete: NoAction, onUpdate: NoAction)
  booking      booking[]
  image        image[]
  price_rate   price_rate[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model booking {
  booking_id      BigInt         @id @unique @default(autoincrement())
  user_id         BigInt
  space_id        BigInt
  expires_at      DateTime       @db.Timestamptz(6)
  booking_type    booking_type   @default(instant)
  status_code     booking_status @default(pending)
  created_at      DateTime       @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?      @default(now()) @db.Timestamptz(6)
  area_id         BigInt
  idempotency_key String         @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  arrival_time    DateTime?      @db.Timestamptz(6)
  from            DateTime?      @db.Timestamptz(6)
  to              DateTime?      @db.Timestamptz(6)
  area            area           @relation(fields: [area_id], references: [area_id], onDelete: NoAction, onUpdate: NoAction)
  space           space          @relation(fields: [space_id], references: [space_id], onDelete: NoAction, onUpdate: NoAction)
  user            user           @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  transaction     transaction[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model bookmark {
  bookmark_id BigInt   @id @unique @default(autoincrement())
  user_id     BigInt
  space_id    BigInt
  created_at  DateTime @db.Timestamptz(6)
  space       space    @relation(fields: [space_id], references: [space_id], onDelete: NoAction, onUpdate: NoAction)
  user        user     @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model image {
  image_id      BigInt   @id @unique @default(autoincrement())
  space_id      BigInt
  area_id       BigInt
  url           String   @db.VarChar
  display_order BigInt
  is_primary    Float
  created_at    DateTime @db.Timestamptz(6)
  area          area     @relation(fields: [area_id], references: [area_id], onDelete: NoAction, onUpdate: NoAction)
  image         image    @relation("imageToimage", fields: [space_id], references: [image_id], onDelete: NoAction, onUpdate: NoAction)
  other_image   image[]  @relation("imageToimage")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model price_rate {
  rate_id    BigInt    @id(map: "rate_pkey") @unique(map: "rate_rate_id_key") @default(autoincrement())
  area_id    BigInt
  time_unit  String    @db.VarChar
  price      Decimal   @db.Decimal
  created_at DateTime  @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  area       area      @relation(fields: [area_id], references: [area_id], onDelete: NoAction, onUpdate: NoAction, map: "rate_area_id_fkey")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model space {
  space_id           BigInt                    @id @unique @default(autoincrement())
  name               String
  unit_number        String
  street             String
  address_subunit    String
  city               String
  region             String
  created_at         DateTime                  @db.Timestamptz(6)
  updated_at         DateTime                  @db.Timestamptz(6)
  postal_code        String                    @db.VarChar
  user_id            BigInt
  description        String?
  country_code       String                    @db.Char(2)
  lat                Decimal                   @db.Decimal(9, 6)
  long               Decimal                   @db.Decimal(9, 6)
  location           Unsupported("geography")?
  amenity            amenity[]
  area               area[]
  booking            booking[]
  bookmark           bookmark[]
  user               user                      @relation(fields: [user_id], references: [user_id])
  space_availability space_availability[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model space_availability {
  availability_id BigInt    @id @unique @default(autoincrement())
  space_id        BigInt
  created_at      DateTime  @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)
  opening         DateTime  @db.Timestamptz(6)
  closing         DateTime  @db.Timestamptz(6)
  day_of_week     Int       @db.SmallInt
  space           space     @relation(fields: [space_id], references: [space_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([space_id, day_of_week], map: "uniq_space_day")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model transaction {
  transaction_id  BigInt    @id @unique @default(autoincrement())
  booking_id      BigInt
  is_live         Boolean   @default(false)
  created_at      DateTime  @default(now()) @db.Timestamptz(6)
  idempotency_key String    @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)
  gateway_data    Json      @unique
  payment_method  gateway
  currency_iso3   String    @default("PHP") @db.Char(3)
  amount_minor    BigInt?
  fee_minor       BigInt?
  booking         booking   @relation(fields: [booking_id], references: [booking_id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model user {
  first_name   String?
  birthday     DateTime?  @db.Date
  is_disabled  Boolean    @default(false)
  created_at   DateTime   @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @db.Timestamptz(6)
  updated_at   DateTime   @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @db.Timestamptz(6)
  user_id      BigInt     @id @unique @default(autoincrement())
  role         user_role  @default(customer)
  middle_name  String?
  last_name    String?
  handle       String     @unique
  avatar       String?
  is_onboard   Boolean    @default(false)
  auth_user_id String     @unique @db.Uuid
  booking      booking[]
  bookmark     bookmark[]
  space        space[]
}

enum auth_provider {
  google
  other
}

enum booking_status {
  pending
  confirmed
  rejected
  expired
  cancelled
  checkedin
  checkedout
  completed
  noshow
}

enum booking_type {
  instant
  request
}

enum gateway {
  paymongo
}

enum user_role {
  customer
  partner
  admin
}
